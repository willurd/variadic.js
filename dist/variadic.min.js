/* Variadic.js - by William Bowers */
!function(){function a(a,c,d){var e=new b;return a(e),e.validate(),function(){return e.process(j(arguments),c,d||this)}}function b(){this._parameterNames=[],this._descriptors={},this._forms=[],this._formMap={},this._flags=[{name:"optional",symbol:"?"},{name:"noLone",symbol:"*"}];var a=this._flags.map(function(a){return"\\"+a.symbol}).join("");this._flagsRegex=new RegExp("^(["+a+"]+)"),this._flagsMap={};for(var b=0,c=this._flags.length;c>b;b++){var d=this._flags[b];this._flagsMap[d.symbol]=d.name}}var c=Object.prototype.toString,d=Array.prototype.slice,e=Array.isArray||function(a){return"[object Array]"===c.call(a)},f=function(a){return"function"==typeof a},g=function(a){return a&&"object"==typeof a&&!f(a)&&!e(a)},h=function(a){return a instanceof RegExp},i=function(a){return"undefined"!=typeof a},j=function(a,b){return d.call(a,b||0)},k=function(a){var b=j(arguments,1);return 0===b.length?a:a.replace(/\{(\d+)\}/g,function(a,c){return b[c]})};a.error=function(a){var b=new Error(a);throw b.name="VariadicError",b};var l={};b.fn=b.prototype,b.fn.getFlags=function(a){var b={},c=a.match(this._flagsRegex);if(!c)return b;for(var d=c[0].split(""),e=0,f=d.length;f>e;e++){var g=this._flagsMap[d[e]];b[g]=!0}return b},b.fn.removeFlags=function(a){return a.replace(this._flagsRegex,"")},b.fn.validate=function(){},b.fn.process=function(b,c,d){var e=this.getBestMatch(b);if(!e)return void a.error(k("Arguments '{0}' do not match any specified form",b.join(", ")));var f=this.processArguments(e,b),g=e.names||[];return c.call(d,f.opt,f.rest,g,b)},b.fn.getBestMatch=function(a){for(var b,c,d=this._forms,e=0,f=d.length;f>e;e++){var g=d[e];if(g.nonEmpty){if(0===a.length)return!1}else{var h=this.rateForm(g,a);if(h===l)return g;var i=b?c:-1;-1!=h&&h>i&&(b=g,c=h)}}return b},b.fn.rateForm=function(b,c){if(0===c.length)return b.empty?l:-1;if(b.empty)return-1;if(b.any)return 0;for(var d=b.names,e=-1,f=0;f<d.length;f++){var g=c[f],h=d[f],i=this._descriptors[h];if(!i)return a.error(k("Unknown parameter: {0}",h)),-1;if(!this.checkArg(h,i,g))return-1;i.any||e++}return e},b.fn.processArguments=function(a,b){var c=a.names||[],d={opt:{},rest:b.slice(c.length)};for(var e in this._descriptors){var f=this.getDefaultValue(this._descriptors[e]);i(f)&&(d.opt[e]=f)}if(!a.empty)for(var g,h=0;g=c[h];h++)d.opt[g]=b[h];return d},b.fn.getDefaultValue=function(a){return f(a.defaultGenerator)?a.defaultGenerator():a.defaultValue},b.fn.checkArg=function(b,c,d){if(c.any)return!0;if("type"in c){if(null!==d&&typeof d===c.type)return!0}else if("cls"in c){if(d instanceof c.cls)return!0}else{if(!("test"in c)){var e="Invalid descriptor '{0}'. Must contain a type, cls, or test property for matching arguments",f=k(e,b);return a.error(f),!1}if(c.test(d))return!0}return!1},b.fn.forms=function(){this.form.apply(this,this._parameterNames.map(function(a){return"?"+a}))},b.fn._removeForms=function(a){for(var b=this._forms,c=b.length-1;c>=0;c--)a(b[c])&&b.splice(c,1);return this},b.fn.form=function(){var a,b=j(arguments),c=b.join(","),d=b.length,e=0;if(this._formMap.hasOwnProperty(c))return this;if(0===b.length)return this.empty();for(a=0;d>a;a++)this.getFlags(b[a]).noLone&&e++;if(e===d)return this;for(this._formMap[c]=!0,this._forms.push({positional:!0,names:b.map(this.removeFlags,this)}),a=d-1;a>=0;a--)this.getFlags(b[a]).optional&&this.form.apply(this,b.slice(0,a).concat(b.slice(a+1)));return this},b.fn.empty=function(){var a="*empty";return this._formMap.hasOwnProperty(a)?this:(this._removeForms(function(a){return a.nonEmpty||a.empty}),this._forms.push({empty:!0}),this._formMap[a]=!0,this)},b.fn.nonEmpty=function(){var a="*nonEmpty";return this._formMap.hasOwnProperty(a)?this:(this._removeForms(function(a){return a.empty}),this._forms.push({nonEmpty:!0}),this._formMap[a]=!0,this)},b.fn.anyForm=function(){return this._forms.push({any:!0}),this},b.fn.add=function(a,b){return this._descriptors[a]=b,this._parameterNames.push(a),this},b.fn.any=function(a,b){return this.add(a,{any:!0,description:"any value",defaultValue:b})},b.fn.type=function(a,b,c,d){return this.add(a,{type:b,description:c,defaultValue:d})},b.fn.test=function(a,b,c,d){return this.add(a,{test:b,description:c,defaultValue:d})},b.fn.cls=function(a,b,c,d){return this.add(a,{cls:b,description:c,defaultValue:d})},b.fn.object=function(a,b){return this.add(a,{test:g,description:"an object",defaultValue:b})},b.fn.array=function(a,b){return this.add(a,{test:e,description:"an array",defaultValue:b})},b.fn.func=function(a,b){return this.add(a,{type:"function",description:"a function",defaultValue:b})},b.fn.string=function(a,b){return this.add(a,{type:"string",description:"a string",defaultValue:b})},b.fn.number=function(a,b){return this.add(a,{type:"number",description:"a number",defaultValue:b})},b.fn.boolean=function(a,b){return this.add(a,{type:"boolean",description:"a boolean",defaultValue:b})},b.fn.regExp=function(a,b){return this.add(a,{test:h,description:"a regular expression",defaultValue:b})},b.fn.date=function(a,b){return this.add(a,{cls:Date,description:"a date",defaultValue:b})},b.fn.match=function(a,b,c,d){return this.add(a,{test:function(a){return b.test(a)},description:c,defaultValue:d})},"undefined"!=typeof exports?("undefined"!=typeof module&&(exports=module.exports=a),exports.variadic=a):this.variadic=a}();